<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>Come aggiungere a WooCommerce articoli con variazione via codice (programmatically) – Alessandro Pagiaro</title> <meta name="description" content="Studente di Informatica presso l'Università di Pisa. Scout a tempo perso."> <meta name="keywords" content="Wordpress, WooCommerce, Hack, Reverse Engineering"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="http://127.0.0.1:4000//assets/img/post-image/woocommerce.png"> <meta name="twitter:title" content="Come aggiungere a WooCommerce articoli con variazione via codice (programmatically)"> <meta name="twitter:description" content="Una guida su come velocizzare l’inserimento dei prodotti su WooCommerce, con l’aiuto del PHP e delle API Wordpress"> <meta name="twitter:site" content="@alessandro308"> <meta name="twitter:creator" content="@alessandro308"> <!-- Open Graph --> <meta property="og:locale" content="it_IT"> <meta property="og:type" content="article"> <meta property="og:title" content="Come aggiungere a WooCommerce articoli con variazione via codice (programmatically)"> <meta property="og:description" content="Una guida su come velocizzare l’inserimento dei prodotti su WooCommerce, con l’aiuto del PHP e delle API Wordpress"> <meta property="og:url" content="http://127.0.0.1:4000/variable-product-programmatically/"> <meta property="og:site_name" content="Alessandro Pagiaro"> <meta property="og:image" content="http://127.0.0.1:4000/assets/img/me.png"> <link rel="canonical" href="http://127.0.0.1:4000/variable-product-programmatically/"> <link href="http://127.0.0.1:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Alessandro Pagiaro Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://127.0.0.1:4000/assets/css/main.css"> <!-- JS --> <script src="http://127.0.0.1:4000/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="http://127.0.0.1:4000/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://127.0.0.1:4000/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://127.0.0.1:4000/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://127.0.0.1:4000/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://127.0.0.1:4000/favicon.png"> <link rel="shortcut icon" href="http://127.0.0.1:4000/favicon.ico"> <!-- Background Image --> <!-- Post Feature Image --> <style type="text/css">.feature {background-image:url(http://127.0.0.1:4000//assets/img/post-image/woocommerce.png);}</style> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://127.0.0.1:4000/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="http://127.0.0.1:4000/assets/img/me.png" alt="Alessandro Pagiaro photo" class="author-photo"> <h4>Alessandro Pagiaro</h4> <p>Studente di Informatica presso l'Università di Pisa. Scout a tempo perso.</p> </li> <li><a href="http://127.0.0.1:4000/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="mailto:alessandropagiaro@gmail.com" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> Email</a> </li> <li> <a href="http://twitter.com/alessandro308" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a> </li> <li> <a href="http://linkedin.com/in/alessandro-pagiaro-9a5a5496" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="http://github.com/alessandro308" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul>
<!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="http://127.0.0.1:4000/posts/">All Posts</a></li> <li><a href="http://127.0.0.1:4000/tags/">All Tags</a></li> </ul> </li> <li><a href="http://127.0.0.1:4000/projects/">Projects</a></li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Come aggiungere a WooCommerce articoli con variazione via codice (programmatically)</h1> <h4>27 Jun 2017</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~7 minutes </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="http://127.0.0.1:4000/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <p><img src="http://127.0.0.1:4000/assets/img/post-image/woocommerce.png" style="float:left; margin: 15px;">Woocommerce è il più famoso plugin di Wordpress per la realizzazione di siti eCommerce. I suoi punti di forza sono tantissimi tra i quali la personalizzazione estrame dei prodotti. Il problema che però spesso si incontra è come caricare in maniera efficiente le decine e decine di prodotti senza perderci le giornate intere?</p> <p>Quello che cercherò di fare io ora, è arrivare ad una soluzione per aggiungere prodotti con variazioni, via codice, andando quindi a velocizzare la fare di inserimento. <br></p> <h1 id="cosa-sono-i-prodotti-con-variazione">Cosa sono i prodotti con variazione</h1> <p>I prodotti con variazione sono quelli oggetti che hanno varie opzioni personalizzabili dall’utente durante la fase di acquisto e il cui prezzo viene modificato in base a queste scelte. Un classico esempio è una tipografia online che vende un volantino che può essere:</p> <ul> <li>A4, A5 o in A6</li> <li>Con 1 colore, 2 colori o 4 colori</li> <li>Su Carta lucida o carta opaca</li> <li>Con grammatura 100, 150 o 200gr</li> <li>Solo fronte o Fronte/Retro</li> </ul> <p>WooCommerce ci permette di aggiungere per ogni possibile scelta dell’utente un prezzo, ad esempio posso specificare che</p> <ul> <li>A4, 1 Colore, Lucida, 100gr, Fronte = 10€</li> <li>A4, 2 colori, Opaca, 100gr, F/R = 12€</li> <li>… ecc ecc</li> </ul> <p>Il problema, come quelli più bravi di voi in combinatoria avranno già visto, è che con anche quelle semplici opzioni definite prima, abbiamo da specificare 108 possibili scelte dell’utente con conseguente impiego di tempo per il caricamente del prodotto. L’idea è quindi quella di trovare un modo più efficiente per fare tutto</p> <p>L’intuizione è quella di creare una funzione in un qualche linguaggio che, date le scelte ed un file CSV (cioè l’esportazione di un file Excel che ci passerà il cliente), ci generi del codice che aggiunge al DB i prodotti comprensivi di variazioni e prezzi.</p> <h1 id="il-database">Il database</h1> <p>Qui inizia il bello, abbiamo vari modi, uno brutale (leggasi SQL puro), l’altro più raffinato che prevede l’impiego delle API di Wordpress. Andiamo a vedere questo secondo approccio perchè più sicuro e veloce.</p> <p>Una rapida ricerca online ci porta a capire quali sono le API che ci interessano in questa fase:</p> <ul> <li>
<code class="highlighter-rouge">wp_insert_post()</code> - Insert or update a post. <a href="https://developer.wordpress.org/reference/functions/wp_insert_post/">doc</a>
</li> <li>
<code class="highlighter-rouge">update_post_meta()</code> - Update post meta field based on post ID. <a href="https://developer.wordpress.org/reference/functions/update_post_meta/">doc</a>
</li> <li>
<code class="highlighter-rouge">wp_set_object_terms()</code> - Create Term and Taxonomy Relationships. <a href="https://developer.wordpress.org/reference/functions/wp_set_object_terms/">doc</a>
</li> <li>
<code class="highlighter-rouge">update_post_meta()</code> - Update post meta field based on post ID. <a href="https://developer.wordpress.org/reference/functions/update_post_meta/">doc</a>
</li> </ul> <p>Per prima cosa dobbiamo inserire il nostro post nella relativa tabella usando la funzione di Wordpress <code class="highlighter-rouge">wp_insert_post</code> e tenendoci poi in memoria il relativo <code class="highlighter-rouge">post_id</code>:</p> <div class="language-php highlighter-rouge"><pre class="highlight"><code>$product_title = "Titolo del prodotto";
$product_description = "Descrizione del prodotto";
$post = array(
        'post_author'  =&gt; 1,
        'post_content' =&gt; $product_description,
        'post_status'  =&gt; 'publish',
        'post_title'   =&gt; $product_title,
        'post_parent'  =&gt; '',
        'post_type'    =&gt; 'product'
    );
$post_id = wp_insert_post($post); 
if(!$post_id){
	return false; // Si è verificato un errore
}
</code></pre></div> <p>Andiamo quindi ad aggiungere altre proprietà del prodotto (generico, senza variazioni), con la funzione <code class="highlighter-rouge">update_post_meta</code> e con la funzione <code class="highlighter-rouge">wp_set_object_terms</code> che modifica le tabelle <code class="highlighter-rouge">wp_terms</code>, <code class="highlighter-rouge">wp_term_relationships</code> e <code class="highlighter-rouge">wp_term_taxonomy</code>:</p> <div class="language-php highlighter-rouge"><pre class="highlight"><code>$product_categories = array("Volantini", "Piccolo Formato");
update_post_meta( $post_id,'_visibility','visible');
wp_set_object_terms( $post_id, $product_categories, 'product_cat');
</code></pre></div> <p>Altre proprietà, i cui nomi sono abbastanza esplicativi, che possiamo andare ad impostare in questa maniera sono le seguenti:</p> <ul> <li>_wc_review_count</li> <li>_wc_rating_count</li> <li>_wc_average_rating</li> <li>_edit_last</li> <li>_edit_lock</li> <li>_sku</li> <li>_regular_price</li> <li>_sale_price</li> <li>_sale_price_dates_from</li> <li>_sale_price_dates_to</li> <li>total_sales</li> <li>_tax_status</li> <li>_tax_class</li> <li>_manage_stock</li> <li>_backorders</li> <li>_sold_individually</li> <li>_weight</li> <li>_length</li> <li>_width</li> <li>_height</li> <li>_upsell_ids</li> <li>_crosssell_ids</li> <li>_purchase_note</li> <li>_default_attributes</li> <li>_virtual</li> <li>_downloadable</li> <li>_product_image_gallery</li> </ul> <p>A questo punto, nella tabella <code class="highlighter-rouge">wp_posts</code> abbiamo il nostro prodotto, a cui dobbiamo ancora aggiungere tutte le varie variazioni.</p> <h1 id="attributi">Attributi</h1> <p class="notice"><strong>Attenzione!</strong> Prima di procedere devi creare gli attributi che andrai ad utilizzare (Dimensione, Colore, Taglia…).<img src="http://127.0.0.1:4000/assets/img/post-image/attr.png" alt="addAttributesMenu"> Lo slug deve essere quello usato poi nel file JSON di riferimento, nel caso in fondo all’articolo quindi “Dimensione” e “Colore”.</p> <p>Per inserire gli attributi dei vari prodotti è un po’ complessa la cosa. O li inseriamo a mano nei vari prodotti e poi andiamo quindi a creare le variazioni nel database con gli attributi già creati, o dobbiamo andare a modificare il record con <code class="highlighter-rouge">meta_key = _product_attributes</code> dentro la tabelle <code class="highlighter-rouge">wp_postmeta</code> che somiglia a questo (che dopo un po’ di ricerche ho scoperto essere una serializzazione PHP):</p> <div class="highlighter-rouge"><pre class="highlight"><code>a:2:{
	s:10:"dimensione";
	a:6:{
		s:4:"name";
		s:10:"Dimensione";
		s:5:"value";
		s:16:"Grande | Piccolo";
		s:8:"position";
		i:0;
		s:10:"is_visible";
		i:1;
		s:12:"is_variation";
		i:0;
		s:11:"is_taxonomy";
		i:0;
		}
	s:6:"colore";
	a:6:{
		s:4:"name";
		s:6:"Colore";
		s:5:"value";
		s:19:"Rosso | Blu | Verde";
		s:8:"position";
		i:1;
		s:10:"is_visible";
		i:1;
		s:12:"is_variation";
		i:0;
		s:11:"is_taxonomy";
		i:0;
		}
	}
</code></pre></div> <p>Usiamo quindi:</p> <div class="highlighter-rouge"><pre class="highlight"><code>unserialize('a:2:{s:10:"dimensione";a:6:{s:4:"name";s:10:"Dimensione";s:5:"value";s:16:"Grande | Piccolo";s:8:"position";i:0;s:10:"is_visible";i:1;s:12:"is_variation";i:0;s:11:"is_taxonomy";i:0;}s:6:"colore";a:6:{s:4:"name";s:6:"Colore";s:5:"value";s:19:"Rosso | Blu | Verde";s:8:"position";i:1;s:10:"is_visible";i:1;s:12:"is_variation";i:0;s:11:"is_taxonomy";i:0;}}');
</code></pre></div> <p>e vediamo che quello che dobbiamo salvare nel database viene da un array fatto nel seguente modo:</p> <div class="highlighter-rouge"><pre class="highlight"><code>array(2) {
  ["dimensione"]=&gt;
  array(6) {
    ["name"]=&gt;
    string(10) "Dimensione"
    ["value"]=&gt;
    string(16) "Grande | Piccolo"
    ["position"]=&gt;
    int(0)
    ["is_visible"]=&gt;
    int(1)
    ["is_variation"]=&gt;
    int(0)
    ["is_taxonomy"]=&gt;
    int(0)
  }
  ["colore"]=&gt;
  array(6) {
    ["name"]=&gt;
    string(6) "Colore"
    ["value"]=&gt;
    string(19) "Rosso | Blu | Verde"
    ["position"]=&gt;
    int(1)
    ["is_visible"]=&gt;
    int(1)
    ["is_variation"]=&gt;
    int(0)
    ["is_taxonomy"]=&gt;
    int(0)
  }
}
</code></pre></div> <p>Possiamo quindi creare un array simile con gli attributi che ci servono, usare la funzione <code class="highlighter-rouge">serialize()</code> e inserire il risultato nella tabella <code class="highlighter-rouge">wp_postmeta</code> con</p> <div class="highlighter-rouge"><pre class="highlight"><code>update_post_meta($post_id, "_product_attributes", serialize($attributes_array))
</code></pre></div> <p>Un modo più carino è stato creato da <a href="http://ryanknights.co.uk/insert-woocommerce-products-variations-programmatically/">ryanknights</a>. Prendendo quindi le informazioni dal file JSON e unendo il tutto ecco la funzione <code class="highlighter-rouge">insert_product_attributes()</code>:</p> <div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="nf">insert_product_attributes</span> <span class="p">(</span><span class="nv">$post_id</span><span class="p">,</span> <span class="nv">$available_attributes</span><span class="p">,</span> <span class="nv">$variations</span><span class="p">)</span>  
<span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$available_attributes</span> <span class="k">as</span> <span class="nv">$attribute</span><span class="p">)</span> <span class="c1">// Go through each attribute
</span>    <span class="p">{</span>   
        <span class="nv">$values</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span> <span class="c1">// Set up an array to store the current attributes values.
</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$variations</span> <span class="k">as</span> <span class="nv">$variation</span><span class="p">)</span> <span class="c1">// Loop each variation in the file
</span>        <span class="p">{</span>
            <span class="nv">$attribute_keys</span> <span class="o">=</span> <span class="nb">array_keys</span><span class="p">(</span><span class="nv">$variation</span><span class="p">[</span><span class="s1">'attributes'</span><span class="p">]);</span> <span class="c1">// Get the keys for the current variations attributes
</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$attribute_keys</span> <span class="k">as</span> <span class="nv">$key</span><span class="p">)</span> <span class="c1">// Loop through each key
</span>            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$key</span> <span class="o">===</span> <span class="nv">$attribute</span><span class="p">)</span> <span class="c1">// If this attributes key is the top level attribute add the value to the $values array
</span>                <span class="p">{</span>
                    <span class="nv">$values</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$variation</span><span class="p">[</span><span class="s1">'attributes'</span><span class="p">][</span><span class="nv">$key</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// Essentially we want to end up with something like this for each attribute:
</span>        <span class="c1">// $values would contain: array('small', 'medium', 'medium', 'large');
</span>
        <span class="nv">$values</span> <span class="o">=</span> <span class="nb">array_unique</span><span class="p">(</span><span class="nv">$values</span><span class="p">);</span> <span class="c1">// Filter out duplicate values
</span>
        <span class="c1">// Store the values to the attribute on the new post, for example without variables:
</span>        <span class="c1">// wp_set_object_terms(23, array('small', 'medium', 'large'), 'pa_size');
</span>        <span class="nx">wp_set_object_terms</span><span class="p">(</span><span class="nv">$post_id</span><span class="p">,</span> <span class="nv">$values</span><span class="p">,</span> <span class="s1">'pa_'</span> <span class="o">.</span> <span class="nv">$attribute</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$product_attributes_data</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span> <span class="c1">// Setup array to hold our product attributes data
</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$available_attributes</span> <span class="k">as</span> <span class="nv">$attribute</span><span class="p">)</span> <span class="c1">// Loop round each attribute
</span>    <span class="p">{</span>
        <span class="nv">$product_attributes_data</span><span class="p">[</span><span class="s1">'pa_'</span><span class="o">.</span><span class="nv">$attribute</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span> <span class="c1">// Set this attributes array to a key to using the prefix 'pa'
</span>
            <span class="s1">'name'</span>         <span class="o">=&gt;</span> <span class="s1">'pa_'</span><span class="o">.</span><span class="nv">$attribute</span><span class="p">,</span>
            <span class="s1">'value'</span>        <span class="o">=&gt;</span> <span class="s1">''</span><span class="p">,</span>
            <span class="s1">'is_visible'</span>   <span class="o">=&gt;</span> <span class="s1">'1'</span><span class="p">,</span>
            <span class="s1">'is_variation'</span> <span class="o">=&gt;</span> <span class="s1">'1'</span><span class="p">,</span>
            <span class="s1">'is_taxonomy'</span>  <span class="o">=&gt;</span> <span class="s1">'1'</span>

        <span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">update_post_meta</span><span class="p">(</span><span class="nv">$post_id</span><span class="p">,</span> <span class="s1">'_product_attributes'</span><span class="p">,</span> <span class="nv">$product_attributes_data</span><span class="p">);</span> <span class="c1">// Attach the above array to the new posts meta data key '_product_attributes'
</span><span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div> <h1 id="aggiungiamo-le-variazioni">Aggiungiamo le variazioni</h1> <p>Arrivati a questo punto abbiamo quindi un <code class="highlighter-rouge">$post_id</code> corrispondente al prodotto in questione. E una array delle variazioni, magari qualcosa del genere:</p> <div class="highlighter-rouge"><pre class="highlight"><code>[
    {
        "attributes": {
            "Dimensione"  : "Grande",
            "Colore" : "Rosso"
        },
        "price" : "8.00"
    },
    {
        "attributes": {
            "Dimensione"  : "Piccolo",
            "Colore" : "Verde"
        },
        "price" : "10.00"
    }
    [...]
]
</code></pre></div> <p>A questo punto non ci resta che inserire le variazioni effettivamente. Le variazioni non sono altro che post con tipo <code class="highlighter-rouge">product_variation</code> e <code class="highlighter-rouge">post_parent</code> il prodotto inserito prima, per capirci <code class="highlighter-rouge">$post_id</code>.</p> <div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="nf">insert_product_variations</span> <span class="p">(</span><span class="nv">$post_id</span><span class="p">,</span> <span class="nv">$variations</span><span class="p">)</span>  
<span class="cm">/* Developed by http://ryanknights.co.uk/insert-woocommerce-products-variations-programmatically/ */</span>
<span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$variations</span> <span class="k">as</span> <span class="nv">$index</span> <span class="o">=&gt;</span> <span class="nv">$variation</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$variation_post</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span> <span class="c1">// Setup the post data for the variation
</span>            <span class="s1">'post_title'</span>  <span class="o">=&gt;</span> <span class="s1">'Variation #'</span><span class="o">.</span><span class="nv">$index</span><span class="o">.</span><span class="s1">' of '</span><span class="o">.</span><span class="nb">count</span><span class="p">(</span><span class="nv">$variations</span><span class="p">)</span><span class="o">.</span><span class="s1">' for product#'</span><span class="o">.</span> <span class="nv">$post_id</span><span class="p">,</span>
            <span class="s1">'post_name'</span>   <span class="o">=&gt;</span> <span class="s1">'product-'</span><span class="o">.</span><span class="nv">$post_id</span><span class="o">.</span><span class="s1">'-variation-'</span><span class="o">.</span><span class="nv">$index</span><span class="p">,</span>
            <span class="s1">'post_status'</span> <span class="o">=&gt;</span> <span class="s1">'publish'</span><span class="p">,</span>
            <span class="s1">'post_parent'</span> <span class="o">=&gt;</span> <span class="nv">$post_id</span><span class="p">,</span>
            <span class="s1">'post_type'</span>   <span class="o">=&gt;</span> <span class="s1">'product_variation'</span><span class="p">,</span>
            <span class="s1">'guid'</span>        <span class="o">=&gt;</span> <span class="nx">home_url</span><span class="p">()</span> <span class="o">.</span> <span class="s1">'/?product_variation=product-'</span> <span class="o">.</span> <span class="nv">$post_id</span> <span class="o">.</span> <span class="s1">'-variation-'</span> <span class="o">.</span> <span class="nv">$index</span>
        <span class="p">);</span>

        <span class="nv">$variation_post_id</span> <span class="o">=</span> <span class="nx">wp_insert_post</span><span class="p">(</span><span class="nv">$variation_post</span><span class="p">);</span> <span class="c1">// Insert the variation
</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$variation</span><span class="p">[</span><span class="s1">'attributes'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$attribute</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="c1">// Loop through the variations attributes
</span>        <span class="p">{</span>   
            <span class="nv">$attribute_term</span> <span class="o">=</span> <span class="nx">get_term_by</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="nv">$value</span><span class="p">,</span> <span class="s1">'pa_'</span><span class="o">.</span><span class="nv">$attribute</span><span class="p">);</span> <span class="c1">// We need to insert the slug not the name into the variation post meta
</span>
            <span class="nx">update_post_meta</span><span class="p">(</span><span class="nv">$variation_post_id</span><span class="p">,</span> <span class="s1">'attribute_pa_'</span><span class="o">.</span><span class="nv">$attribute</span><span class="p">,</span> <span class="nv">$attribute_term</span><span class="o">-&gt;</span><span class="na">slug</span><span class="p">);</span>
          <span class="c1">// Again without variables: update_post_meta(25, 'attribute_pa_size', 'small')
</span>        <span class="p">}</span>

        <span class="nx">update_post_meta</span><span class="p">(</span><span class="nv">$variation_post_id</span><span class="p">,</span> <span class="s1">'_price'</span><span class="p">,</span> <span class="nv">$variation</span><span class="p">[</span><span class="s1">'price'</span><span class="p">]);</span>
        <span class="nx">update_post_meta</span><span class="p">(</span><span class="nv">$variation_post_id</span><span class="p">,</span> <span class="s1">'_regular_price'</span><span class="p">,</span> <span class="nv">$variation</span><span class="p">[</span><span class="s1">'price'</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div> <h1 id="come-far-funzionare-il-tutto">Come far funzionare il tutto</h1> <p>Arrivati a questo punto non ci resta che mettere insieme tutti i pezzi. Il problema ora è che abbiamo usato delle funzioni di Wordpress che dovranno essere eseguite, chiaramente, all’interno del framework di Wordpress. La cosa più semplice da fare è quella di creare un plugin che, una volta installato, esegua tutte queste funzioni e ci aggiorni il database.</p> <h2 id="creare-un-plugin">Creare un plugin</h2> <p>Andiamo a creare un nuovo file PHP, <code class="highlighter-rouge">myplugin.php</code>, che, una volta attivato, eseguirà il nostro codice:</p> <div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
   <span class="cm">/*
   Plugin Name: WooCommerce Variable Product Test
   Plugin URI: http://wordpress.org
   Description: My Plugin
   Version: 1.0
   Author: Me
   Author URI: http://wordpress.org
   License: GPL2
   */</span>

   <span class="k">function</span> <span class="nf">onActivation</span><span class="p">(){</span>
     <span class="c1">// Inseriamo qui tutto il nostro codice che deve essere eseguito
</span>   <span class="p">}</span>
   <span class="nx">register_activation_hook</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">,</span> <span class="s1">'onActivation'</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div> <p>That’s all! Nice coding!</p> <p>Complete plugin ready to run: <a href="http://127.0.0.1:4000/assets/plugin.zip">download it</a></p> <h4 id="references">References</h4> <p><a href="http://ryanknights.co.uk/insert-woocommerce-products-variations-programmatically/">ryanknights.co.uk</a></p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="http://127.0.0.1:4000/tags/#Wordpress" title="Pages tagged Wordpress" class="tag"><span class="term">Wordpress</span></a><a href="http://127.0.0.1:4000/tags/#WooCommerce" title="Pages tagged WooCommerce" class="tag"><span class="term">WooCommerce</span></a><a href="http://127.0.0.1:4000/tags/#Hack" title="Pages tagged Hack" class="tag"><span class="term">Hack</span></a><a href="http://127.0.0.1:4000/tags/#Reverse%20Engineering" title="Pages tagged Reverse Engineering" class="tag"><span class="term">Reverse Engineering</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://127.0.0.1:4000/variable-product-programmatically/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=http://127.0.0.1:4000/variable-product-programmatically/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=http://127.0.0.1:4000/variable-product-programmatically/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="http://127.0.0.1:4000/assets/js/jquery-1.12.0.min.js"></script> <script src="http://127.0.0.1:4000/assets/js/jquery.dlmenu.min.js"></script> <script src="http://127.0.0.1:4000/assets/js/jquery.goup.min.js"></script> <script src="http://127.0.0.1:4000/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://127.0.0.1:4000/assets/js/jquery.fitvid.min.js"></script> <script src="http://127.0.0.1:4000/assets/js/scripts.js"></script> <!-- Asynchronous Google Analytics snippet --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-105829132-1', 'auto'); ga('require', 'linkid', 'linkid.js'); ga('send', 'pageview'); </script> <script type="text/javascript"> var disqus_shortname = 'alessandro308'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
