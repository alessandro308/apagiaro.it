<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Bluetooth Low Energy - Overview</title>

		<link rel="stylesheet" href="https://apagiaro.it/revealjs/css/reveal.css">
		<link rel="stylesheet" href="https://apagiaro.it/revealjs/css/theme/sky.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="https://apagiaro.it/revealjs/lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'https://apagiaro.it/revealjs/css/print/pdf.css' : 'https://apagiaro.it/revealjs/css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h2>Bluetooth Low Energy: a brief overview</h2>
					<h4>Alessandro Pagiaro</h4>
					<img src="img/ble.jpg"/>
				</section>
				<section>
					Introducted in 4.0, BLE becames pervasive on smartphone since its simplicity and power usage.<br/>
					Bluetooth devices can be diveded into 3 categories according their Bluetooth version:
					<img src="img/bluetooth_tecno.png"/>
				</section>
				<section>
					<section><h2>Protocol Basics: introduction</h2></section>
					Protocol Basics: introduction
					<section>
						<h4>BLE in the device can be seen as 3 components:</h4>
						<br/>
						<ul>
							<li> Application: Logic, UI, Data Handling </li>
							<li> Host: "Bluetooth things" (GAP, GATT, L2CAP, ATT, SM, HCI)</li>
							<li>Controller: HCI, LL, PHY</li>
						</ul>
					</section>
					<section>
						<h3>A BLE device can be</h3>
						<ul>
							<li class="fragment">a master, initializer</li>
							<li class="fragment">a slave, advertise ability and accept connection</li>
							<li class="fragment">or both</li>
						</ul>
					</section>
					<section>
						<h2>Connections</h2>
						A master can connect to multiple slaves.<br/>
						A slave can be connected to multiple masters.
						<br/><br/>
						A master usually needs more resource to perform connection.
					</section>
				</section>
				<section>PHY
					<section><h3>This layer is a PHYsical layer.</h3></section>
					<section>
						<ul>
							<li>It menages analog communication circuitry</li>
							<li>It transforms analog signal to digital one</li>
						</ul>
					</section>
					<section>
						<h2>Radio</h2>
						<p>The frequency used is the 2.4GHz, divided into 40 channels from 2.4000 GHz to 2.4835 GHz.
						<br/><br/>
						37 Channels are used for data, 3 for advertising.
						<br/><br/>
						Frequency hopping spread spectrum is used to minimize interference
						</p>
						<pre>
(channel = (curr_channel + hop) mod 37)
						</pre>
					</section>
				</section>
				<section>LL
					<section><h2>Link Layer</h2></section>
					<section>
						<aside class="notes">Link Layer is usually implemented as a combination of hardware and software.</aside>
						Link Layer defines the following roles:
						<ul>
							<li class="fragment">Advertiser (not active connection)</li>
							<li class="fragment">Scanner (not active connection)</li>
							<li class="fragment">Master (active connection)</li>
							<li class="fragment">Slave (active connection)</li>
						</ul>

						<br/><br/>
						<p class="fragment">It provides a reliable data link, using a 24-bit CRC and retransmit packet if error is detected.</p>

					</section>
					<section>
						<h4>BLE DEVICE ADDRESS<br/>
						Is a 48 bit number that uniquely identify a device.</h4>
						<h6>There are two types of device addresses:</h6>
						<ul>
							<li class="fragment">Public device address (fixed, BR/EDR-style)</li>
							<li class="fragment">Random device address (programmed or dinamically generated)
								<ul>
									<li class="fragment">
										Static Address (static but not registered to IEEE)
									</li>
									<li class="fragment">
										Non-resolvable private address
									</li>
									<li class="fragment">
										Resolvable private address
										<aside class="notes">Random resolvable private address is generated by IRK + random number. Only devices that possess the IRK can resolve this address</aside>
									</li>
								</ul>
							</li>
						</ul>
					</section>
					<section>
						<h4>Advertising &amp; Scanning</h4>
						<p>BLE has only one packet format and two type of packets: advertising and data packets.</p>
						<aside class="notes">
						Advertising are use to:
						<ul>
							<li>broadcast data without overhead of a full connection</li>
							<li>discover slave and connect to</li>
						</ul></aside>
						<p class="fragment">Each <u>advertising packet</u> can carry up 31 bytes of payload. They are sent at fixed rate, defined by advertising <i>interval</i>.</p>
					</section>
					<section>
						<img src="img/24.png"/>
					</section>
					<section>
						<p>Scanning can be passive or active. The difference is on the replay that scanner emit after receiving a advertising packet.<p>
						Advertising packet types can be:
						<ul>
							<li>Connectable / non-connectable</li>
							<aside class="notes">
								Non-connectable is used only for broadcast packet
							</aside>
							<li>Scannable / non-scannable</li>
							<li>Direct / Undirect</li>
							<aside class="notes">Direct means that the packet contains the target scanner's Bluetooth address in its payload</aside>
						</ul>
					</section>
					<section>
						<h4>Connections</h4>
						<img src="img/conn.png"/><br/>
						Each connection has 3 proprieties:
						<ul>
							<li>Connection interval (from 7.5ms up to 4s)</li>
							<li>Slave latency</li>
							<li>Connection supervision timeout</li>
						</ul>
					</section>
				</section>
				<section>HCI
					<section><h2>Host Controller Interface</h2></section>
					<section>
						Is a standard protocol that allows for the communication between a host and a controller to take place across a serial interface.
						<aside class="notes">
							This is the only module that has hard real-time requirements
						</aside>
					</section>
				</section>
				<section>
					L2CAP
					<section>
						<h2>Logical Link Control and Adaptation Protocol</h2>
					</section>
					<section>
						Provides two functionalities
						<ul>
							<li class="fragment">implements a protocol multiplexer that permits to communicate from the upper layers and encapsulates the packets into standard BLE packet format</li>
							<li class="fragment">performs fragmentation and recombination, breaks packet up into chunks that fit into 27-byte maximum payload</li>
						</ul>
						<p class="fragment">
							It has two main protocol:
							<ul class="fragment">
								<li>ATT (Attribute protocol)</li>
								<li>SMP (Security Manager protocol)</li>
							</ul>
						</p>
					</section>
				</section>
				<section>
					ATT
					<section><h2>Attribute protocol</h2></section>
					<section>Is a stateless client/server protocol based on attributes presented by a device.
						<br/><br/>
Each server contains data organized as "attributes", each of which is assigned a 16-bit attribute handle, a UUID, a set of permissions and a value.</section>
	<aside class="notes">The attribute handle is an id used to access to attribute value.</aside>
					<section>
						ATT operations:
						<ul>
							<li>Error handling</li>
							<li>Server Configuration</li>
							<li>Find Information</li>
							<li>Read Operation
								<ul>
									<li>Read by type Request/Response (UUID)</li>
									<li>Read Request/Response (handle)</li>
								</ul>
							</li>
							<li>Write operation
									<ul>
										<li>Write a value and get response</li>
										<li>Write command</li>
										<li>Signed Write Command</li>
									</ul>
							</li>
							<li>Queued Write (multiple packet write)</li> 
							<li>Server initialization</li>
						</ul>
					</section>
				</section>
				<section>SM
					<section><h2>Security Manager</h2></section>
					<section>
						<p><h4>It is used to </h4>
						<ul>
							<li class="fragment">Exchange keys</li>
							<li class="fragment">Encrypt connection</li>
							<li class="fragment">Hide a public BLE</li>
						</ul><br/><br/>
						<h4 class="fragment">It defines two roles</h4>
						<ul>
							<li class="fragment">Initiator (master)</li>
							<li class="fragment">Responder (slave)</li>
						</ul></p>
					</section>
					<section>
						SM protocol supports threee procedures:
						<ul>
							<li class="fragment">Pairing (temporary keys)</li>
							<li class="fragment">Bonding (permanent keys)</li>
							<li class="fragment">Encryption re-establishment</li>
						</ul>
					</section>
					<section><h4>Pairing Algorithm</h4>
						<ul>
							<li class="fragment">Negotiate a Short Term Key (STK) generation method:
								<ul class="fragment">
									<li>Just Works!</li>
									<li>Passkey Display</li>
									<li>Out of band (OOB)</li>
								</ul>
							</li>
							<li class="fragment">The connection can use various machanism
								<ul>
									<li class="fragment">Encryption (full encryption)</li>
									<li class="fragment">Privacy (use a temporary address recognized only by bounded device)</li>
									<li class="fragment">Signing (enencrypted but signed packet)</li>
								</ul>
							</li>
						</ul>
						
					</section>
				</section>
				<section>GATT
					<section>
						<h2>Generic Attribute Profile</h2>
					</section>
					<section>
						It is build on the ATT and adds a hierarchy and data abstraction model on top of ATT. It is a backbone of BLE data trasfer. 
						<br/>
						Data are encapsulated in services, with one or more characteristics.
					</section>
					<section>
						Each service and characteristic is identify by a UUID. A UUID (Universally Unique ID) is a unique 128-bit number used to identify the services. Some UUID are defined in the Bluetooth Specs and are smaller (16 ore 32 bits). 
					</section>
					<section>
						<p>The smallest data entity are the <b>attributes</b>. Attribute is an abstract concept for storing data. <br/>
						Each attribute has some metadata that specific which ATT operation can be executed with some permissions.</p>
						<div class="fragment">The permissions defined are:
						<ul>
							<li>Access Permission (None | R | W | R&amp;W)</li>
							<li>Encryption (None | Unauthenticated | Authenticated)</li>
							<li>Authorization (No Auth | Auth required)</li>
						</ul></div>
						Each attribute has an handle associated with it, used to identify the attribute on a particular GATT server.
					</section>
					<section>
						The maximum length of data is 512 bytes, by the specification. No restriction exists on data types.
						<img class="fragment grow" src="img/tabella41.png"/>
					</section>
					<section>
						Attributes in a GATT server are grouped into services, each of which can contains zero or more characteristics.
						<br/>
						Characteristic is a data container, with declaration and value.
					</section>
				</section>
				<section>
					<section>
						<h3>Real World Screenshot</h3>
						This screenshot refers to my MiBand 2, the application used on Raspian is bleah
					</section>
					<section>
						<img src="img/bleah1.png"/>
					</section>
					<section>
						<img src="img/bleah2.png"/>
					</section>
				</section>
				<section>
						Referencies:
						<small>
						<p><ul>
							<li>Wikipedia - https://en.wikipedia.org/wiki/Bluetooth_Low_Energy</li>
							<li>Getting Started with BLE - OReilly - http://shop.oreilly.com/product/0636920033011.do</li>
							<li>Bluetooth SIG - https://www.bluetooth.com</li>
						</ul>
						</p>
						<br/>
						<p>
					Slides avaiable on <a href="https://apagiaro.it">https://apagiaro.it/BLE-slides</a>
				</p></small>
				</section>
			</div>
		</div>

		<script src="https://apagiaro.it/revealjs/lib/js/head.min.js"></script>
		<script src="https://apagiaro.it/revealjs/js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'https://apagiaro.it/revealjs/plugin/markdown/marked.js' },
					{ src: 'https://apagiaro.it/revealjs/plugin/markdown/markdown.js' },
					{ src: 'https://apagiaro.it/revealjs/plugin/notes/notes.js', async: true },
					{ src: 'https://apagiaro.it/revealjs/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
